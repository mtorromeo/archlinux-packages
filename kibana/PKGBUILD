# Contributor: Spider.007 <archlinux AT spider007 DOT net>

pkgname=kibana
pkgver=5.1.1
pkgrel=2
pkgdesc="browser based analytics and search dashboard for Elasticsearch. Please note; this package replaces the distributed precompiled binary 'node'"
arch=('any')
url="https://www.elastic.co/products/kibana"
license=('apache')
depends=('nodejs')
optdepends=('elasticsearch>=2.4')
backup=('etc/kibana/kibana.yml')
options=('!strip')
install='kibana.install'
source=(
	"https://artifacts.elastic.co/downloads/$pkgname/$pkgname-$pkgver-linux-x86_64.tar.gz"
	kibana.service
	user.conf
	tmpfile.conf)
sha256sums=('da0383be8a12936c7d2a0a145e7bf0eb15abf972e585e0115ed8742032c79245'
            '60a6f7931356d2d64d080e270b513c827e04cd9f25109eb0c1abe31a57a83abe'
            '7df2fc315461da233fc29dc0ee3df7a66e291013bd0d38716d668c69b4ad8f7d'
            '03c35273ad89f4a21eb5466c3f30c0d7b75886bb305996002c1846fb5f7a078b')

package() {
	cd "$pkgdir"

	install -dm755 usr/share/kibana
	install -dm755 var/lib/kibana
	install -Dm644 "$srcdir/kibana.service" usr/lib/systemd/system/kibana.service
	install -Dm644 "$srcdir/user.conf" usr/lib/sysusers.d/kibana.conf
	install -Dm644 "$srcdir/tmpfile.conf" usr/lib/tmpfiles.d/kibana.conf

	cd "$srcdir/$pkgname-$pkgver-linux-x86_64"

	install -Dm644 config/kibana.yml "$pkgdir"/etc/kibana/kibana.yml

	rm -rf node data
	cp -Rp * "$pkgdir"/usr/share/kibana/
}
